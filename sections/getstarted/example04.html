<div class="examples">
	<a id="top"></a><h1>Example 04</h1>
	<div class="white-container">
		In <a href="#/getStarted/example02">Example02</a> we used <a href="#/documentation/services/oauth">oAuth</a> to secure our service, and in <a href="#/getStarted/example03">Example03</a> we examined how to secure a service using tenant keys permissions.

		In this example we will show you that you can use oAuth together with multitenancy.
		Everything is similar to Example03 with few exceptions.
		<hr/>
		<h3>Start the Service</h3>
		We already have Urac services running, and the data is imported.
		All we need now is to start <b>Example04</b>:
		<pre><code class="bash">#start example04
$ cd /opt/soajs/node_modules/soajs.examples/examples04
$ node .</code></pre>
		<p>
			<b>Example04</b> is now running on http://127.0.0.1:4013.<br/>
            Let's do a heartbeat check just to make sure all is working as expected before we begin the tests.<br/><br/>
		</p>

		<fieldset><legend>Heartbeat Example04</legend>
			<div class="insideFieldsetMain">
				<div>
					<pre><code class="bash">$ curl -X GET "http://127.0.0.1:5013/heartbeat"</code></pre>
					<h6><u>Response:</u></h6>

					<div ng-init="loadJSON(path + 'example04/heartbeat_example04.json', 'heartbeat_example04');">
						<div id="heartbeat_example04"></div>
					</div>
					<p>Example04 is registered in SOAJS with port <u>4013</u> making the maintenance port of this service as <u>5013</u>.
					   As you can see, the service is running.
					</p>
				</div>
			</div>
		</fieldset>
		<hr/>
		<h3>Running Some Tests</h3>
		<fieldset><legend>Tenant 1: 1st Application</legend>
			<div class="insideFieldsetMain">
				<div>
					<p>
						We will hit "example04/buildName" using the key of the first application from the first tenant like we did in example03.
					</p>
					<pre><code class="bash">$ curl -X GET -H "key:4232477ed993d167ec13ccf8836c29c400fef7eb3d175b1f2192b82ebef6fb2d129cdd25fe23c04f856157184e11f7f57b65759191908cb5c664df136c7ad16a56a5917fdeabfc97c92a1f199e457e31f2450a810769ff1b29269bcb3f01e3d2" "http://127.0.0.1:4000/example04/buildName?lastName=Smith"</code></pre>
					<h6>Response:</h6>

					<div ng-init="loadJSON(path + 'example04/tenant1_test1.json', 'tenant1_test1');">
						<div id="tenant1_test1"></div>
					</div>
					<p>
						Access denied! We need to login with oauth first.
					</p>
				</div>
			</div>
		</fieldset>
		<fieldset><legend>Login to oAuth</legend>
			<div class="insideFieldsetMain">
				<div>
					<p>
						Like in <a href="#/getStarted/example02">Example02</a>, we need to login to oAuth and an access_token.
					</p>
					<pre><code class="bash">$ curl -X POST -H "Authorization: Basic NTRlZTIxNTBiN2E2NjlmYzIyYjdmNmI5Ok15IHNlY3JldCBwaHJhc2U=" -H "key:4232477ed993d167ec13ccf8836c29c400fef7eb3d175b1f2192b82ebef6fb2d129cdd25fe23c04f856157184e11f7f57b65759191908cb5c664df136c7ad16a56a5917fdeabfc97c92a1f199e457e31f2450a810769ff1b29269bcb3f01e3d2" "http://127.0.0.1:4000/oauth/token" -d 'username=oauthuser_tenant1&password=oauthpassword_tenant1&grant_type=password'</code></pre>
					<h6>Response:</h6>
					<div ng-init="loadJSON(path + 'example04/oauth_login.json', 'oauth_login');">
						<div id="oauth_login"></div>
					</div>
					<p>
						Like in Example02, the login to oAuth returned a token value. We need to add this <b>access_token</b> value to the consequent api calls.
					</p>
				</div>
			</div>

		</fieldset>

		<fieldset><legend>Call API again with oAuth token</legend>
			<div class="insideFieldsetMain">
				<div>
					<p>
						We will hit "example04/buildName" again with "access_token" as an additional query parameter:
					</p>
					<pre><code class="bash">$ curl -X GET -H "key:4232477ed993d167ec13ccf8836c29c400fef7eb3d175b1f2192b82ebef6fb2d129cdd25fe23c04f856157184e11f7f57b65759191908cb5c664df136c7ad16a56a5917fdeabfc97c92a1f199e457e31f2450a810769ff1b29269bcb3f01e3d2" "http://127.0.0.1:4000/example04/buildName?lastName=Smith&access_token=e59104df7256d2d0a77771303ea81fd68ed39e45"</code></pre>
					<h6>Response:</h6>
					<div ng-init="loadJSON(path + 'example04/response1.json', 'response1');">
						<div id="response1"></div>
					</div>
					<em>Awesome!</em>
				</div>
			</div>
		</fieldset>
		<p>
			Once you are done here, let's move on to more advanced functionality in the next step.
		</p>
		<div style="clear:both; width:100%; display: table;">
			<a class="small-button" href="#/getStarted/advanced">Next &raquo;</a>
		</div>
	</div>
</div>