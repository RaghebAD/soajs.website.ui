<a id="deployment-overview"></a>
<h1>Deployment Overview</h1>
<div class="white-container">
	<p>
		SOAJS refers to Service Oriented Architecture in JavaScript. The framework is built on top of NodeJs, its data layer is built on top of MongoDB, uses HAproxy to create awareness among its services and finally Nginx is used for the front and entry layer.<br/>
		<img ng-src="images/documentation/deployment-overview.png"/>
	</p>
	<hr/>
	<h3>3rd Party Technologies</h3>

	<p>
		As mentioned above, SOAJS requires some technologies to be installed on the machine along with it. Make sure you have these technologies installed and available on your machine:
	</p>
	<ul>
		<li><a href="http://www.mongodb.org" target="_blank">MongoDB</a> ( version 2.6.7 or higher)</li>
		<li><a href="http://www.nodejs.org" target="_blank">NodeJs</a> (version 0.10.25 or higher)</li>
		<li><a href="http://www.nginx.com" target="_blank">Nginx</a> ( version 1.6.2 or higher )</li>
		<li><a href="http://www.haproxy.org" target="_blank">HAproxy</a> ( version 1.5.9 or higher )</li>
	</ul>
	<hr/>
	<h3>SOAJS Packages</h3>
	<p>
		SOAJS comes with the following packages:
	</p>
	<table class="myTable">
		<thead>
			<tr>
				<th>Package Name</th>
				<th>Package Description</th>
			</tr>
		</thead>
		<tbody>
			<tr class="odd">
				<td width="20%"><b>soajs</b></td>
				<td>Framework that you will use to develop your services.</td>
			</tr>
			<tr class="even">
				<td width="20%"><b>soajs.controller</b></td>
				<td>SOAJS gateway service used as an entry point and forwards requests to designated services.</td>
			</tr>
			<tr class="odd">
				<td width="20%"><b>soajs.oauth</b></td>
				<td>Security service, can be used to protect your service using oAuth 2.0</td>
			</tr>
			<tr class="even">
				<td width="20%"><b>soajs.urac</b></td>
				<td>User Registration and Access Control, can be used to handle and manage user accounts per tenant.</td>
			</tr>
			<tr class="odd">
				<td width="20%"><b>soajs.examples</b></td>
				<td>Examples Package, contains 4 examples going from basic service example to fully advanced featured service.</td>
			</tr>
			<tr class="even">
				<td width="20%"><b>soajs.dashboard</b></td>
				<td>Dashboard Service, provides access to core database of SOAJS, enables management of tenants, products, environments and oAuth accounts.</td>
			</tr>
		</tbody>
	</table>
	<br/>
	<h4>Basic Service</h4>
	<p>
		<img ng-src="images/documentation/basic_service.png" class="image-right"/>
		Building a basic SOAJS service requires only two of the above mentioned packages: <a href="#/documentation">Framework</a> and <a href="#/documentation/services/controller">Controller</a>.<br />
		You need the framework to build your service and you need the controller so it can forward the requests to your services. This scenario is explained in depth in <a href="#/getStarted">Get Started</a> / <a href="#/getStarted/example01">Example 01</a>.<br />
		When the request reaches your services, it passes through the framework first, SOAJS does its magic on the arriving data, then gives you that data along with additional tools to use. Run the data through the business logic of your service, then pass it back to the framework so it can formulate a response out of it and return it to the sender.
	</p>
	<br />
	<h4>Secured Service</h4>
	<p>
		You can always protect your service by installing the oauth package from the list. This way your service becomes accessible only to logged in oauth users. When the request is made to your service, the controller first forward the request to the oauth service for security checking, if ok, the request is then forwarded to your service.<br />
		This scenario is explained in depth in <a href="#/getStarted">Get Started</a> / <a href="#/getStarted/example02">Example 02</a> and <a href="#/getStarted/example04">Example 04</a>. Example 02, transforms a basic service to a protected service by oauth whereas Example 04 goes much deeper and protects a multitenant service with oauth.<br />
		<img ng-src="images/documentation/secured_service.png"/><br />
		To configure your service to be protected by oauth, set the property oauth to true while creating a new instance of it.<br />
		<a href="#/documentation/core/service">Click Here</a> to see the list of properties a service can use when you create it with SOAJS.
	</p>
	<br/>
	<hr/>
	<h3>Data Layer</h3>
	<p>
		The data layer of soajs is built on top of MongoDB and uses the Two databases: CORE_PROVISION & CORE_SESSION
	</p>
	<h4>CORE_PROVISION</h4>
	<img ng-src="images/documentation/core_provision.png" class="image-right" />
	<table class="myTable">
		<thead>
			<tr>
				<th>Collection Name</th>
				<th>Description</th>
			</tr>
		</thead>
		<tbody>
			<tr class="odd">
				<td width="20%"><b>environments</b></td>
				<td>List of environments and their IP addresses matching registry configuration.</td>
			</tr>
			<tr class="even">
				<td width="20%"><b>tenants</b></td>
				<td>List of available tenants and their applications and keys information.</td>
			</tr>
			<tr class="odd">
				<td width="20%"><b>products</b></td>
				<td>List of available products and their packages along with the ACL permissions.</td>
			</tr>
			<tr class="even">
				<td width="20%"><b>oauth_users</b></td>
				<td>List of oAuth user accounts related to tenants.</td>
			</tr>
			<tr class="odd">
				<td width="20%"><b>oauth_tokens</b></td>
				<td>List of tokens related to oAuth users accounts.</td>
			</tr>
		</tbody>
	</table>
	<br/><br/>
	<img ng-src="images/documentation/core_session.png" class="image-right" />
	<table class="myTable">
		<thead>
			<tr>
				<th>Collection Name</th>
				<th>Description</th>
			</tr>
		</thead>
		<tbody>
			<tr class="odd">
				<td width="20%"><b>sessions</b></td>
				<td>List of sessions with full details on requests made by tenants, containing cookies, session information, api requested, key provided, passed parameters ...</td>
			</tr>
		</tbody>
	</table>
	<br/><br/><br/>
	<hr/>
	<h3>Service Scenario</h3>
	<p>
		When a request arrives to your service, it goes through the framework first then your business logic then it goes back to the framework before returning. The first entry to the framework, adds SOAJS alters the data as configured by the constructor parameters and adds the tools that SOAJS offers, SOAJS also talk to the data layer to check the key provided and the permissions and load the <a href="#/documentation/core/provisioning">provisioned</a> data based on the current running environment as configured in the <a href="#/documentation/core/registry">registry</a>. The second time the framework is used which is before returning the response, soajs formulates a unified and valid REST response before returning this response.<br />
		<img ng-src="images/documentation/service_scenario.png"><br />
	</p>
	<br/>
	<hr/>
	<h3>Services and their Data Layer</h3>
	<p>
		SOAJS core services use the data layer differently. Not all services access all the collections, some simply read from it and some add and modify data in the collections. Let's go over the data layer of each service that comes with soajs and the relation between your service and them.
	</p>

	<h4>Controller Service</h4>
	<p>
		<img ng-src="images/documentation/controller_service.png" class="image-right"/><br />
		The controller is the gateway to soajs services. It reads and compares the information in the request with that in CORE_PROVISION. Information like tenant keys device and geo security as well as Access permissions is loaded from the database and compared.
	</p>
	<br/><br/>
	<h4>Dashboard Service</h4>
	<p>
		<img ng-src="images/documentation/dashboard_service.png" class="image-right"/><br />
		The dashboard services, manages the information inside CORE_PROVISION collections. This service is responsilbe for creating environment, products, tenants and oauth users records.
	</p>
	<br/><br/>
	<h4>oAuth Service</h4>
	<p>
		<img ng-src="images/documentation/oauth_service.png" class="image-right"/><br />
		The oauth services, reads the tenant oauth secret and the user information from tenants and oauth_users collections in core_provision database and if the verification is valid, it inserts/update the user token in oauth_tokens collection.
	</p>
	<br/><br/>
	<h4>Urac Service</h4>
	<p>
		<img ng-src="images/documentation/urac_service.png" class="image-right"/><br />
		The urac services, reads the tenant information to determine if the provided key exists and has can access the service. Now that it knows the name of the tenant that the given key belongs to, all consequent requests are inserted/updated in a new database named after the tenant: TENANTNAME_URAC.
	</p>
	<br/><br/>
	<h4>Examples Service</h4>
	<p>
		The examples services contains 3 services: Example02, 03, 04 that communicate with the data layer. This package is a guideline to how your services might be constructed. Example 01 does not communicate with the database, it simply manipulates the arriving input and sends it back in the response. Example 02 and 04 are protected by oAuth security and Example 02, 03, 04 provide tenant keys in the request. The following diagram illustrates how these examples work.<br />
		<img ng-src="images/documentation/examples_service.png" /><br /><br />
		The diagram above shows 4 different combinations of how a service can be constructed to work with soajs packages and the data layer.
	</p>
	<ul>
		<li><span style="color:red;">Controller</span> communicates with both CORE_PROVISION & CORE_SESSION</li>
		<li><span style="color:orange;">oAuth</span> communicates with CORE_PROVISION</li>
		<li><span style="color:mediumpurple;">URAC</span> communicates with CORE_PROVISION & TENANTNAME_URAC</li>
		<li><span style="color:dodgerblue;">Example 03 & 04</span> have their own custom database (just like your service will be)</li>
	</ul>
	<p>
		This architecture can be set up on either a single machine ( All in One ) or on a cloud and will behave and run the same way regardless of the hardware used, the only difference is that cloud architecture requires more servers and more configuration to set it up than simply installing it all on the one machine.
	</p>
</div>