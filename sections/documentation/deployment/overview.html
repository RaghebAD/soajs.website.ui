<a id="deployment-overview"></a>
<h1>Deployment Overview</h1>
<div class="white-container">
	<p>
		SOAJS means to Service Oriented Architecture JavaScript. The framework is built on top of NodeJs, its data layer is built on top of MongoDB, HAproxy is there to create awareness among services and finally Nginx is used as the entry layer.<br/>
		<img ng-src="images/documentation/deployment-overview.png"/>
	</p>
	<p>
		SOAJS requires the following 3rd party technologies to be installed on the machine:
	</p>
	<ul>
		<li><a href="http://www.mongodb.org" target="_blank">MongoDB</a> ( version 2.6.7 or higher)</li>
		<li><a href="http://www.nodejs.org" target="_blank">NodeJs</a> (version 0.10.25 or higher)</li>
		<li><a href="http://www.nginx.com" target="_blank">Nginx</a> ( version 1.6.2 or higher )</li>
		<li><a href="http://www.haproxy.org" target="_blank">HAproxy</a> ( version 1.5.9 or higher )</li>
	</ul>
	<hr/>
	<h3>SOAJS Packages</h3>
	<p>
		SOAJS comes with the following packages:
	</p>
	<table class="myTable">
		<thead>
			<tr>
				<th>Package Name</th>
				<th>Package Description</th>
			</tr>
		</thead>
		<tbody>
			<tr class="odd">
				<td width="20%"><b>soajs</b></td>
				<td>Framework that you will use to develop your services.</td>
			</tr>
			<tr class="even">
				<td width="20%"><b>soajs.controller</b></td>
				<td>SOAJS gateway service used as an entry point and forwards requests to designated services.</td>
			</tr>
			<tr class="odd">
				<td width="20%"><b>soajs.oauth</b></td>
				<td>Security service, can be used to protect your services using oAuth 2.0</td>
			</tr>
			<tr class="even">
				<td width="20%"><b>soajs.urac</b></td>
				<td>User Registration and Access Control, can be used to handle and manage user accounts per tenant.</td>
			</tr>
			<tr class="odd">
				<td width="20%"><b>soajs.examples</b></td>
				<td>Examples Package, contains 4 examples going from basic service example to fully advanced service example.</td>
			</tr>
			<tr class="even">
				<td width="20%"><b>soajs.dashboard</b></td>
				<td>This is the admin dashboard for soajs, enables you to configure and manage your services using a UI.</td>
			</tr>
		</tbody>
	</table>
	<br/>
	<h4>Basic Service</h4>
	<p>
		<img ng-src="images/documentation/basic_service.png" class="image-right"/>
		Building a basic SOAJS service requires only two of the above mentioned packages: <a href="#/documentation">Framework</a> and <a href="#/documentation/services/controller">Controller</a>.<br />
		You need the framework to build your service and you need the controller so it can forward the requests to your service. This scenario is explained in depth in <a href="#/getStarted">Get Started</a> / <a href="#/getStarted/example01">Example 01</a>.<br />
		When the request reaches your service, SOAJS framework captures the request first, executes the needed features based on how you configured soajs framework for this service and throws an error or hands over the request to your service business logic.
	</p>
	<br />
	<h4>Basic Service with oAuth</h4>
	<p>
		This is exactly like the previous basic service example but with oauth turned on.<br />
		This scenario is explained in depth in <a href="#/getStarted">Get Started</a> / <a href="#/getStarted/example02">Example 02</a> and <a href="#/getStarted/example04">Example 04</a>. If you attempt to directly hit the api of either Example 02 or Example04 without providing an access_token, the request will be rejected. You will need to request a token from the oauth service first, and provide it in the consecutive requests to Example 02 and 04 services.
		<br />
		<img ng-src="images/documentation/secured_service.png"/><br />
		To configure your service to be protected by oauth, set the property oauth to true.<br />
		<a href="#/documentation/core/service">Click Here</a> to see the list of properties a service can use when you create it with SOAJS.
	</p>
	<br/>
	<hr/>
	<h3>Data Layer</h3>
	<p>
		The data layer of soajs framework is built on top of MongoDB and uses two databases: CORE_PROVISION & CORE_SESSION
	</p>
	<h4>CORE_PROVISION</h4>
	<img ng-src="images/documentation/core_provision.png" class="image-right" />
	<table class="myTable">
		<thead>
			<tr>
				<th>Collection Name</th>
				<th>Description</th>
			</tr>
		</thead>
		<tbody>
			<tr class="odd">
				<td width="20%"><b>environments</b></td>
				<td>List of environments and their IP addresses matching registry configuration.</td>
			</tr>
			<tr class="even">
				<td width="20%"><b>tenants</b></td>
				<td>List of available tenants and their applications and keys information.</td>
			</tr>
			<tr class="odd">
				<td width="20%"><b>products</b></td>
				<td>List of available products and their packages along with the ACL permissions.</td>
			</tr>
			<tr class="even">
				<td width="20%"><b>oauth_users</b></td>
				<td>List of oAuth user accounts related to tenants.</td>
			</tr>
			<tr class="odd">
				<td width="20%"><b>oauth_tokens</b></td>
				<td>List of tokens related to oAuth users accounts.</td>
			</tr>
		</tbody>
	</table>
	<br/><br/>
	<h4>CORE_SESSION</h4>
	<img ng-src="images/documentation/core_session.png" class="image-right" />
	<table class="myTable">
		<thead>
			<tr>
				<th>Collection Name</th>
				<th>Description</th>
			</tr>
		</thead>
		<tbody>
			<tr class="odd">
				<td width="20%"><b>sessions</b></td>
				<td>List of sessions with full details on requests made by tenants, containing cookies, session information, api requested, key provided, passed parameters ...</td>
			</tr>
		</tbody>
	</table>
	<br/><br/><br/>
	<p>
		When a request arrives to your service, it goes through the framework first then your business logic then it goes back to the framework before returning. The first entry to the framework, adds SOAJS alters the data as configured by the constructor parameters and adds the tools that SOAJS offers, SOAJS also talk to the data layer to check the key provided and the permissions and load the <a href="#/documentation/core/provisioning">provisioned</a> data based on the current running environment as configured in the <a href="#/documentation/core/registry">registry</a>. The second time the framework is used which is before returning the response, soajs formulates a unified and valid REST response before returning this response.<br />
		<img ng-src="images/documentation/service_scenario.png"><br />
	</p>
	<br/>
	<hr/>
	<h3>SOAJS Services and their appropriate Data Layer</h3>
	<p>
		We used SOAJS framework and created services that we call the SOAJS core services. Let us go over each one of them and explain their approriate data layer.
	</p>

	<h4>Controller Service</h4>
	<p>
		The controller is the gateway to soajs services. It receives the request, runs some validation steps and forwards the request to your service. The controller does not require any data layer.
	</p>
	<br/>
	<table width="100%">
		<tr>
			<td valign="middle">
				<h4>oAuth Service</h4>
				<p>
					The oauth services, reads the tenant oauth secret and the user information from tenants and oauth_users collections in core_provision database and if the verification is valid, it inserts/update the user token in oauth_tokens collection.
				</p>
			</td>
			<td valign="middle"><img ng-src="images/documentation/oauth_service.png"/></td>
		</tr>
	</table>
	<br/>
	<table width="100%">
		<tr>
			<td valign="middle">
				<h4>Urac Service</h4>
				<p>
					The urac service, manages users and groups records. SOAJS framework provides the services with the tenant name based on the key provided in the request. The business logic of the service uses the tenant name to determine which database the records should be inserted/updated.
				</p>
			</td>
			<td valign="middle"><img ng-src="images/documentation/urac_service.png"/></td>
		</tr>
	</table>
	<br/>
	<table width="100%">
		<tr>
			<td valign="middle">
				<h4>Dashboard Service</h4>
				<p>
					The dashboard services, manages the information inside CORE_PROVISION collections. The business logic of this service is responsible for creating environment, products, tenants and oauth users records.
				</p>
			</td>
			<td valign="middle"><img ng-src="images/documentation/dashboard_service.png"/></td>
		</tr>
	</table>
	<br/>
	<h4>Examples Service</h4>
	<p>
		The examples services contains 4 examples starting with a basic service example all the way to a multitenant oAuth protected example.
	</p>
	<table width="100%">
		<tr>
			<td valign="middle">
				<b>Example 01</b>
				<p>
					This example is very basic, its business logic reads the input parameters, formulates a json object out of them and returns the object in the response. The service is not configured to communicate with any data layer.
				</p>
			</td>
			<td valign="middle"><img ng-src="images/documentation/example01_service.png" /></td>
		</tr>
	</table>
	<table width="100%">
		<tr>
			<td valign="middle"><img ng-src="images/documentation/example02_service.png" /></td>
			<td valign="middle">
				<b>Example 02</b>
				<p>
					This example is exactly like Example 01, its business logic reads the input parameters, formulates a json object out of them and returns the object in the response. The service is configured to use oauth but its business logic does not communicate with the data layer.
				</p>
			</td>
		</tr>
	</table>
	<table width="100%">
		<tr>
			<td valign="middle">
				<b>Example 03</b>
				<p>
					This example is a multitenant service, and can only be used by tenants. If you attempt to directly hit the api of Example 03 without providing a tenant key, the request will be rejected. You will need to provide a tenant key that has access to this service in your request so it gets evaluated.<br />The service formulates a json response out of the inputs it receives and its business logic does not communicate with any data layer.
				</p>
			</td>
			<td valign="middle"><img ng-src="images/documentation/example03_service.png" /></td>
		</tr>
	</table>
	<table width="100%">
		<tr>
			<td valign="middle"><img ng-src="images/documentation/example04_service.png" /></td>
			<td valign="middle">
				<b>Example 04</b>
				<p>
					This example is a multitenant service that is also protected by oauth. If you attempt to directly hit the api of Example 04 without providing a tenant key or an oauth access_token, the request will be rejected. You will need to request a token from the oauth service first, then provide it along with the tenant key in the consecutive requests to any of Example 04 APIs.<br />
					The business logic of this service, formulates a response out of the inputs it receives and therefore does not communicate with any data layer.
				</p>
			</td>
		</tr>
	</table>
	<br/>
	<table width="100%">
		<tr>
			<td valign="middle">
				<p>
					SOAJS gives you the ability to create your services the way you want. Your service business logic can work with the data layer or not. If your service requires to store or fetch data from the data layer here is a diagram of how it might look like:
				</p>
			</td>
			<td valign="middle"><img ng-src="images/documentation/your_service.png" /></td>
		</tr>
	</table>
</div>