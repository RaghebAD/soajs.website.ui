<a id="docker-deployment"></a>
<h1>Docker Deployement</h1>
<div class="white-container">
	<p>
		In this section we will show you how to download, install and deploy SOAJS on your machine via Docker. To begin with, we suggest you create the following folder schema so you can place SOAJS Utilities inside it:
	</p>
	<pre><code class="bash"># soajs modules go here
$ mkdir -p /opt/soajs/node_modules/</code></pre>
	<p>
		The above command creates a folder on the root level named <b>opt</b> with <b>soajs</b> folder inside it and <b>node_modules</b> folder inside <b>soajs</b>.
	</p>
	<hr/>
	<h3>Installation</h3>
	<p>
		SOAJS can be installed manually on your machine using Docker with little effort needed:
	</p>
	<h4><u>Step1</u></h4>
	<p>
		SOAJS is built using NodeJs therefore, you need to have NodeJs installed and running on your machine.
	</p>
	<pre><code class="bash"># install NodeJs latest stable version
$ apt-get install nodejs</code></pre>
	<p>
		Once NodeJs is installed, install <a target="_blank" href="http://www.npmjs.org/packages/soajs.utilities">soajs.utilities</a> in /opt/soajs/node_modules to acquire the configuration files needed to deploy SOAJS.
	</p>
	<pre><code class="bash"># navigate to node_modules
$ cd /opt/soajs/node_modules/

# install soajs.utilities
$ npm install soajs.utilities</code></pre>
	<p>
		Now that you have NodeJs, and the Utilities installed install <a href="https://docs.docker.com/installation/" target="_blank">Docker Installation Page</a> and install docker and <a href="https://docs.docker.com/compose/" target="_blank">docker-compose</a> on the machine you are using.<br />
		<b><u>Note:</u></b> If your machine uses Mac OS X, then you need <a href="https://github.com/boot2docker/osx-installer/releases/latest" target="_blank">boot2docker</a> installed along with Docker and docker-compose.
	</p>
	<p>
		Our Team has prepared 3 Docker composer files for you to help you get started quickly:
	</p>
	<ol>
		<li><b>All:</b> Contains all Services with controller.</li>
		<li><b>All with Dashboard:</b> Contains all services with controller and dashboard</li>
		<li><b>All with Examples:</b> Contains all services with controller, dashboard and all examples.</li>
	</ol>
	<p>
		In this tutorial we will use the 3rd file that contains all the services, controller and examples. The first stop is to install, start MongoDB and patch the sample provisioned data from Utilities.
	</p>
	<div class="redFlag">install and start mongo using docker: antoine will provide commands</div>
	<pre><code class="bash">$ docker run --name some-mongo -d mongo</code></pre>
	<p>
		Once MongoDB is installed via docker, you need to create a folder on your machine to map the data to it:
	</p>
	<pre><code class="bash">$ mkdir -p /data/db/ </code></pre>
	<fieldset>
		<legend>OSX Machines</legend>
		<div>
			<p>
				OSX Machines use boot2docker therefore additional steps are required after executing the above command:
			</p>
			<pre><code class="bash"># ssh to boot2docker, create /data with the right permissions
$ boot2docker ssh
$ sudo mkdir -p /data
$ sudo chgrp staff -R /data
$ sudo chmod 775 -R /data</code></pre>
		</div>
	</fieldset>
	<p>
		Now Start Mongo using the following command:
	</p>
	<pre><code class="bash">$ docker run -p 27017:27017 -v /data:/data -v /data/db:/data/db mongo mongod --smallfiles</code></pre>
	<p>
		Now that MongoDB is running, import the sample data from utilities:
	</p>
	<pre><code class="bash">$ cd /opt/soajs/node_modules/soajs.utilities/lib

# import sample data to Mongo Docker
$ node index data import provision %ip address of mongo docker machine%
$ node index data import urac %ip address of mongo docker machine%</code></pre>
	<br/>
	<fieldset>
		<legend>OSX Machines:</legend>
		<p>
			On OSX machines, the import command takes the following IP Address:
		</p>
		<pre><code class="bash"># import sample data to Mongo Docker
$ node index data import provision $(boot2docker ip)
$ node index data import urac $(boot2docker ip)</code></pre>
	</fieldset>
	<h4><u>Step2</u></h4>
	<p>
		Now that you have set up mongo and imported the data, let's run the docker composer and install/start all the services. Navigate to the Utilities composer folder:
	</p>
	<pre><code class="bash">$ cd /opt/soajs/node_modules/soajs.utilities/deployment/composer/runAll_w_examples/

# run composer file
$ docker-compose up</code></pre>
	<p>
		The above command will execute the content of the <b>docker-compose.yml</b> file that contains instructions on which docker images should be pulled, which services need to be installed and started. Once the above command has finished execution, you can start some heartbeat tests on the services that were installed.
	</p>
	<fieldset>
		<legend>URAC</legend>
		<div>
			<p>
				Perform a Heartbeat check on the service:
			</p>
			<pre><code class="bash">$ curl -X GET "http://api.soajs.org:5001/heartbeat"</code></pre>
			<p>
				URAC services runs on port 4001 making its maintenance port equal to 5001 as explained in <a href="#/documentation/core/service">service</a> section under documentation.
			</p>
			<h5>Response:</h5>
			<pre><code class="bash">{"result":true,"ts":1427373613796,"service":{"service":"URAC","type":"rest","route":"/heartbeat"}}</code></pre>
			<em>URAC is healthy ... Great!</em>
		</div>
	</fieldset>
	<fieldset>
		<legend>oAuth</legend>
		<div>
			<p>
				Perform a Heartbeat check on the service:
			</p>
			<pre><code class="bash">$ curl -X GET "http://api.soajs.org:5002/heartbeat"</code></pre>
			<p>
				oAuth services runs on port 4002 making its maintenance port equal to 5002.
			</p>
			<h5>Response:</h5>
			<pre><code class="bash">{"result":true,"ts":1427373613796,"service":{"service":"OAUTH","type":"rest","route":"/heartbeat"}}</code></pre>
		</div>
	</fieldset>
	<fieldset>
		<legend>Dashboard</legend>
		<div>
			<p>
				Dashboard contains 2 sections, service and UI. At this stage, we are working with the service and the UI is explained below. Perform a Heartbeat check on the service:
			</p>
			<pre><code class="bash">$ curl -X GET "http://api.soajs.org:5003/heartbeat"</code></pre>
			<p>
				Dashboard services runs on port 4003 making its maintenance port equal to 5003.
			</p>
			<h5>Response:</h5>
			<pre><code class="bash">{"result":true,"ts":1427373613796,"service":{"service":"DASHBOARD","type":"rest","route":"/heartbeat"}}</code></pre>
		</div>
	</fieldset>
	<fieldset>
		<legend>Example01</legend>
		<div>
			<p>
				The Examples package contains 5 services as examples: Example01 - Example02 - Example03 - Example04 - Hello World. Perform a Heartbeat check on the each service:
			</p>
			<pre><code class="bash">$ curl -X GET "http://api.soajs.org:5010/heartbeat"</code></pre>
			<p>
				Example01 services runs on port 4010 making its maintenance port equal to 5010.
			</p>
			<h5>Response:</h5>
			<pre><code class="bash">{"result":true,"ts":1427373613796,"service":{"service":"EXAMPLE01","type":"rest","route":"/heartbeat"}}</code></pre>
		</div>
	</fieldset>
	<fieldset>
		<legend>Example02</legend>
		<div>
			<p>
				Perform a Heartbeat check on the service:
			</p>
			<pre><code class="bash">$ curl -X GET "http://api.soajs.org:5011/heartbeat"</code></pre>
			<p>
				Example02 services runs on port 4011 making its maintenance port equal to 5011.
			</p>
			<h5>Response:</h5>
			<pre><code class="bash">{"result":true,"ts":1427373613796,"service":{"service":"EXAMPLE02","type":"rest","route":"/heartbeat"}}</code></pre>
		</div>
	</fieldset>
	<fieldset>
		<legend>Example03</legend>
		<div>
			<p>
				Perform a Heartbeat check on the service:
			</p>
			<pre><code class="bash">$ curl -X GET "http://api.soajs.org:5012/heartbeat"</code></pre>
			<p>
				Example03 services runs on port 4012 making its maintenance port equal to 5012.
			</p>
			<h5>Response:</h5>
			<pre><code class="bash">{"result":true,"ts":1427373613796,"service":{"service":"EXAMPLE03","type":"rest","route":"/heartbeat"}}</code></pre>
		</div>
	</fieldset>
	<fieldset>
		<legend>Example04</legend>
		<div>
			<p>
				Perform a Heartbeat check on the service:
			</p>
			<pre><code class="bash">$ curl -X GET "http://api.soajs.org:5013/heartbeat"</code></pre>
			<p>
				Example02 services runs on port 4013 making its maintenance port equal to 5013.
			</p>
			<h5>Response:</h5>
			<pre><code class="bash">{"result":true,"ts":1427373613796,"service":{"service":"EXAMPLE04","type":"rest","route":"/heartbeat"}}</code></pre>
		</div>
	</fieldset>
	<fieldset>
		<legend>Hello World</legend>
		<div>
			<p>
				Perform a Heartbeat check on the service:
			</p>
			<pre><code class="bash">$ curl -X GET "http://api.soajs.org:5020/heartbeat"</code></pre>
			<p>
				Hello World services runs on port 4020 making its maintenance port equal to 5020.
			</p>
			<h5>Response:</h5>
			<pre><code class="bash">{"result":true,"ts":1427373613796,"service":{"service":"HELLO_WORLD","type":"rest","route":"/heartbeat"}}</code></pre>
		</div>
	</fieldset>
	<fieldset>
		<legend>Controller</legend>
		<div>
			<p>
				The final service we will run and test is the controller of SOAJS. The controller is the main gateway to SOAJS services and performs awareness tests and healthy checks on all the services on a periodic basis. Perform a Heartbeat check on the service:
			</p>
			<pre><code class="bash">$ curl -X GET "http://api.soajs.org:5000/heartbeat"</code></pre>
			<p>
				The controller services runs on port 4000 making its maintenance port equal to 5000.
			</p>
			<h5>Response:</h5>
			<pre><code class="bash">{"result":true,"ts":1427373613796,"service":{"service":"CONTROLLER","type":"rest","route":"/heartbeat"}}</code></pre>
		</div>
	</fieldset>
	<h4><u>Step3</u></h4>
	<p>
		Now that all services are checked, let's launch the Dashboard UI, login and start working. We begin by updating the hosts file on the machine and point out the IP address of the Docker Nginx Machine for theses domains:
	</p>
	<pre><code class="bash">$ gedit /etc/hosts

127.0.0.1   api.soajs.org
127.0.0.1   dashboard-api.soajs.org
127.0.0.1   dashboard.soajs.org</code></pre>
	<p>
		<u><b>Note:</b></u> Make sure you put the correct IP address instead of 127.0.0.1
	</p>
	<p>
		The domain dashboard-api.soajs.org redirects requests to the dashboard services which allows you to manage the provisioned information in core database whereas api.soajs.org redirects to the services that only read the provisioned information from the core database.
	</p>
	<p>
		Open your browser and go to <a target="_blank" href="http://dashboard.soajs.org">http://dashboard.soajs.org</a> and login using the administrator account. The administrator account was created with all needed permissions when you imported the provisioned data in the early step. The sample data provides an administrator account with the following credentials:
	</p>
	<ul>
		<li><b>Username:</b>&nbsp; admin</li>
		<li><b>Password:</b>&nbsp; password</li>
	</ul>
	<p>
		Once you login, you can modify these credentials, monitor the services and perform all core operations related to <a href="#/documentation/advanced/multitenancy">Multitenancy</a>, <a href="#/documentation/advanced/productization">Productization</a>, <a href="#/documentation/advanced/environment">Multi Environment</a> and other. Checkout the <a href="#/documentation/ui/dashboard">Dashboard</a> to see what features are offered.
	</p>
</div>