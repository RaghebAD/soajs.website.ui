<a id="soajs.controller"></a>
	<h1>SOAJS Controller</h1>
<div class="white-container">
	<p>
		SOAJS Controller is the main gateway to its cloud of service APIs.<br/>
        All requests are made to this gateway first and then forwarded based on the route requested after clearance checking.
	</p>
	<hr/>
	<h3>Features</h3>
	<ol>
		<li>
			<u><b>Self Awareness:</b></u><br/>

			<p>
				The controller's main functionality is to validate the request and redirect it to the requested service. Before redirecting to the requested service, the controller checks if the service is alive and running. This approach allows the self awareness feature that SOAJS offers.<br/><br/>
				If a service is down or does not exist, the controller will return a message back to the sender without crashing. When a new service is created or added to the cloud, the controller will detect its presence. All requests to this new service will then be forwarded.<br/><br/>
				The Controller runs on port <b>4000</b>. To request a service in the cloud, simply add the service name after the port number as a path parameter. To request a specific API in that service, type the route path after the service name.<br/><br/>
				<u>Ex:</u>
			</p>
			<pre><code class="bash">#CURL -X %method% http:// %controller host% : 4000 / %service name% / %route path% /
CURL -X POST "http://127.0.0.1:4000/urac/login"</code></pre>
			<em>The above example calls SOAJS's Controller, then requests the urac service and route login.</em>
			<br/><br/><br />
		</li>
		<li>
			<u><b>Key Security:</b></u><br/>

			<p>
				When a request is made to SOAJS and a key is specified, the controller checks the key.<br />
				Before forwarding the request or checking if the service is up and running, the controller makes a database call and:
			</p>
			<ol>
				<li>Checks that the key exists.</li>
				<li>Retrieves the ACL of the tenant that this key belongs to and checks if the tenant has permission to use the requested service.</li>
				<li>Performs a heartbeat check to make sure the service is healthy and running.</li>
				<li>Checks the Authorization of the header if the service is oAuth protected and requires authorization to be accessed.</li>
				<li>Forwards the request if all is ok.</li>
			</ol>
			<img ng-src="images/documentation/controller.png" style="margin:5px 0;" />
			<br /><br />
		</li>
		<li>
			<u><b>CORS:</b></u><br/>

			<p>
				SOAJS controller also provides support for <a href="http://en.wikipedia.org/wiki/Cross-origin_resource_sharing" target="_blank">CORS</a> (Cross Origin Resource Sharing).<br/><br/>
                Enabling <b>CORS</b> allows different domains to communicate with SOAJS via its gateway to post and pull resources without having to deal with <b>"cross-domain"</b> issues and by simply using the standard protocols: GET - POST - DELETE - PUT.
			</p>
		</li>
	</ol>
	<hr/>
	<h3>Usage</h3>
	<p>
		SOAJS controller is located in <a href="https://npmjs.com/packages/soajs.util" target="_blank">soajs.util</a>.<br />
		Install:<br />
		<pre><code class="bash">$ npm install soajs.util</code></pre><br />
		Then navigate to the directory where it is installed and run the service.<br />
		<pre><code class="bash">$ cd soajs.util/controller
$ node index</code></pre><br />
		The service is now running and listening to port 4000.
	</p>
	<hr />
	<h3>Calling the Service</h3>
	<p>
		<pre><code class="bash">CURL -X %method% "http://127.0.0.1:4000"</code></pre>
		By Default, the controller is configured to use port 4000 as specified in the <a href="#/documentation/registry">registry</a>.<br />

		<h6><u>Response:</u></h6>
		<pre><code class="json" ng-bind-html="controller|json"></code></pre>
	<em>The above shows the response of the call to: http://127.0.0.1:4000. No service is called yet</em>
	</p>
	<script>renderCodeSnippets();</script>
</div>