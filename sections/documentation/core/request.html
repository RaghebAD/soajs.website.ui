<a id="request"></a>
<h1>SOAJS Request</h1>
<div class="white-container">
	<p>
		When you build your service, SOAJS adds its functionality and properties to the request and response of that service. These features empower the developer to have all the tools needed to develop the API quickly and offer common ground between team members.<br/>
	</p>
	Here is a list of what SOAJS adds to the request object:
	<h3><b><u>SOAJS Request</u></b></h3>

	<table width="100%" class="myTable">
		<thead>
			<tr>
				<th style="min-width: 38px;">Property</th>
				<th>Purpose</th>
			</tr>
		</thead>
		<tbody>
			<tr ng-repeat="feature in request" ng-class="{'first': $first, 'last': $last}" ng-class-odd="'odd'" ng-class-even="'even'">
				<td><b>{{feature.property}}</b></td>
				<td>{{feature.purpose}}</td>
			</tr>
		</tbody>
	</table>
	<hr/>
	<div ng-init="loadCode(path + 'core/request/index.js', 'requestjs');">
		<div id="requestjs"></div>
	</div>
    <br/>
    <hr/>
    <h3>Usage:</h3>
    <p>
        <b>req.soajs</b> can be invoked from any API at runtime to fetch the running configuration and use SOAJS's core methods.
    </p>
    <h4>Active Configuration</h4>
    <p>
        You can use <b>req.soajs</b> to:
    </p>
    <ul>
        <li>Read the current registry information: <b>req.soajs.registry</b>
            <pre><code class="javascript">service.get("/hello", function(req, res) {
    console.log(req.soajs.registry);
});</code></pre>
            <em>
                More Information at <a href="#/documentation/core/registry">Registry</a>.
            </em><br/><br/>
        </li>
        <li>Read the IMFV inputs: <b>req.soajs.inputmaskData</b>
            <pre><code class="javascript">service.get("/hello", function(req, res) {
    console.log(req.soajs.inputmaskData);
});</code></pre>
            <em>
                More Information at <a href="#/documentation/core/imfv">IMFV</a>.
            </em><br/><br/>
        </li>
        <li>Read the service configuration: <b>req.soajs.serviceConfig</b>
            <pre><code class="javascript">service.get("/hello", function(req, res) {
    console.log(req.soajs.serviceConfig);
});</code></pre>
            <em>
                Example at <a href="#/documentation/db/mongo">SOAJS Mongo</a>.
            </em><br/><br/>
        </li>
        <li>Read the current tenant information: <b>req.soajs.tenant</b>
            <pre><code class="javascript">service.get("/hello", function(req, res) {
    console.log(req.soajs.tenant);
});</code></pre>
            <em>
                Example at <a href="#/documentation/db/mongo">SOAJS Mongo</a>.
            </em><br/><br/>
        </li>
        <li>Read the logged in user information: <b>req.soajs.session.getUrac()</b>
            <pre><code class="javascript">service.get("/hello", function(req, res) {
    console.log(req.soajs.session.getUrac());
    console.log(req.soajs.session.getGroups());
    console.log(req.soajs.session.getAcl());
});</code></pre>
            <em>
                Example at <a href="#/documentation/services/urac">URAC / Service Information</a>
            </em><br/>
        </li>
    </ul>
    <br/>
    <h4>SOAJS functionality</h4>
    <p>
        You can use <b>req.soajs</b> to:
    </p>
    <ul>
        <li>use the logger to output logs on the console based on log type: <b>req.soajs.log</b>
            <pre><code class="javascript">service.get("/hello", function(req, res) {
    req.soajs.log.error("any message, object, array .... ");
    req.soajs.log.info("any message, object, array .... ");
    req.soajs.log.warn("any message, object, array .... ");
    req.soajs.log.debug("any message, object, array .... ");
});</code></pre><br/>
        </li>
        <li>use buildResponse to construct a unified and valid REST response: <b>req.soajs.buildResponse</b>
            <pre><code class="javascript">service.get("/hello", function(req, res) {
    var response1 = req.soajs.buildResponse(new Error("Something went wrong...");
    res.json(response1);

    var response2 = req.soajs.buildResponse({"code": 401, "msg": "Something went wrong..." });
    res.json(response2);

    var response3 = req.soajs.buildResponse(null, { "a": "b" });
    res.json(response3);
});</code></pre>
            <em>
                More Information at <a href="#/documentation/core/response">Response</a>.
            </em><br/><br/>
        </li>
        <li>use the meta to fetch a multitenant database configuration based on the current tenant: <b>req.soajs.meta</b>
            <pre><code class="javascript">service.get("/hello", function(req, res) {
    var config = req.soajs.meta.tenantDB(req.soajs.registry.tenantMetaDB, "myMTdbName", req.soajs.tenant.code);
    var mongo = new soajs.mongo(config);
});</code></pre>
            <em>
                More Information at <a href="#/documentation/db/mongo">SOAJS Mongo</a>.
            </em><br/><br/>
        </li>
        <li>use the validator to perform JSON schema validation: <b>req.soajs.validator</b>
            <pre><code class="javascript">service.get("/hello", function(req, res) {
    var data = 4;
    var schema = {"type": "number"};
    var x = req.soajs.validator.validate(data, schema);
    req.soajs.log.debug(x);
});</code></pre>
            <em>
                More Information at <a href="https://www.npmjs.com/package/jsonschema" target="_blank">NPM JSONSCHEMA</a>.
            </em><br/><br/>
        </li>
    </ul>
</div>