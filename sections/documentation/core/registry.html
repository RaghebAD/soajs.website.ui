<a id="registry"></a>
<h1>Registry</h1>
<div class="white-container">
    <p>
        SOAJS offers the ability to have multiple projects running on different environments with different configuration. Projects are located in SOAJS under the <b>profiles</b> folder.<br />The name of the project is set using an <a href="http://en.wikipedia.org/wiki/Environment_variable" target="_blank">environment variable</a> on your machine or the project named <b>default</b> is used, the same applies on which environment will be loaded, and where to loacate the projects registry information.<br />SOAJS uses 3 environment variables to locate the project profile to use:
    </p>
    <ul>
        <li><b>SOAJS_REGDIR</b>: The path from the root level to where the profiles folder is located.</li>
        <li><b>SOAJS_PRJ</b>: The project folder inside the profiles folder that should be used.</li>
        <li><b>SOAJS_ENV</b>: The environment to load from the profiles folder.</li>
    </ul>
    <p>
		By default, SOAJS looks for the profiles folder if the environment variable is not set in its root folder. This folder contains the project name, environments and all registry coniguration needed by SOAJS so that the application can run.<br />You can change the path of the profiles folder to another destination but keep in mind if you do that, you need to update the value of the environment value <b>SAOJS_REGDIR</b>.
		The same concept applies for project and environment names, by default, SOAJS uses the <b>default</b> project name in profiles folder and the <b>dev</b> environment. When you create a new project make sure you update <b>SOAJS_PRJ</b> and when you deploy on a new environment other than <b>dev</b>, also change <b>SOAJS_ENV</b>.
    </p>
    <p>
        Every Project can run in different environments. You define for each environment: the DB configuration, the templates, the services and their options. The default one is <b>dev</b>.
    </p>
    <p>
        Projects also have templates and configuration files that are used inside the running environment. Configure your database connection and place your service templates in these
        designated areas.
    </p>
    <hr/>
    <h3>Environment Registry Configuration</h3><br/>

    <p>
    <h4>1- General Registry Information</h4>

    <p>Create an environment and give it a name and a version</p>
	<pre><code class="javascript">var registry ={
	"name": "dev",
	"version": "0.1",
	"environment":"develop",
	"projectPath": "/opt/soajs/node_modules/soajs/profiles/default/",
	//...
}</code></pre>
    <h4>2- Database Configuration</h4>

    <p>Defines the core databases used by the <a href="#/documentation/ui/dashboard">dashboard</a></p>
    <pre><code class="javascript">"coreDB": {
	"dashboard": {
		"name": "core_dashboard",
		"prefix": dServers.prefix,
		"servers": dServers.servers,
		"credentials": dServers.credentials,
		"URLParam": dOptions.URLParam,
		"extraParam": dOptions.extraParam
	}
	//...
}</code></pre>

	<h4>3- Meta Database Configuration</h4>
	<p>Defines the tenant meta data databases used by services such as <a href="#/documentation/services/urac">Urac</a></p>
    <pre><code class="javascript">"tenantMetaDB": {
    "service_name": {
        "name": "core_dashboard",
        "prefix": dServers.prefix,
        "servers": dServers.servers,
        "credentials": dServers.credentials,
        "URLParam": dOptions.URLParam,
        "extraParam": dOptions.extraParam
    }
    //...
}</code></pre>
	<h4>4- Service Configuration</h4>
	<p>Contains the services configuration such as awareness timeout, enabling CORS, logger & cookies information ....</p>
	<pre><code class="javascript">"serviceConfig": {
	"awareness": {
		"healthCheckInterval": 5000,
		"autoRelaodRegistry": 300000
	},
	"agent": { ... },
	"key": { ... },
	"logger": { ... },
	"cors": { ... },
	"oauth": { ... },
	"ports": { ... },
	"cookie": {
		"secret": "this is a secret sentence"
	},
	"session": { ... }
}</code></pre>

	<a id="rest-apis"></a>
    <h4>5- REST APIs Configuration</h4>

    <p>Define the services by providing host, port, url and extKeyRequired.</p>
	<ul>
		<li>port: The port that the service is listening on</li>
		<li>requestTimeout: Timeout value</li>
		<li>requestTimeoutRenewal: Timeout value renewal</li>
		<li>extKeyRequired:
		<ul>
			<li>when <b>extKeyRequired</b> is false: set it to false for services that are public and accessible without providing tenant keys.</li>
			<li>when <b>extKeyRequired</b> is  true: set it to true for services that are only accessible if a tenant key is provided in the request.</li>
		</ul>
		</li>
	</ul>
    <pre><code class="javascript">"services": {
    "controller": {
        "extKeyRequired": false,
	    "port": 4000,
	    "host": "127.0.0.1",
	    "maxPoolSize": 100,
	    "requestTimeout": 30,
	    "requestTimeoutRenewal": 0,
	    "authorization": true
    },
    "helloworld": {
        "extKeyRequired": true,
        "port": 4001,
        "requestTimeoutRenewal": null,
        "requestTimeout": null
    }
    "helloworld": {
	    "extKeyRequired": false,
	    "port": 4020,
	    "requestTimeoutRenewal": null,
        "requestTimeout": null
    }
    //...
}</code></pre>
	<p>
		The above snippet shows 2 services; each having different information configured. Services like Controller, do not need tenant keys to work and that is why <b>extKeyRequired</b> is set to <b>false</b>. Services like <a href='#/documenation/urac'>URAC</a>require a <b>tenant key</b> to be accessible so their <b>extKeyRequired</b> is set to <b>true</b>.
	</p>
    <br />
    <hr/>
    <h4>Details & Code Sample</h4>
    <tabset>
        <tab heading="Details">
            <table class="myTable">
                <thead>
                <tr>
                    <th>Property</th>
                    <th>Type</th>
                    <th>Mandatory</th>
                    <th>Notes</th>
                </tr>
                </thead>
                <tbody>
                <tr ng-repeat="detail in registry" ng-class="{'first': $first, 'last': $last}" ng-class-odd="'odd'" ng-class-even="'even'">
                    <td width="20%">{{detail.property}}</td>
                    <td>{{detail.type}}</td>
                    <td>{{detail.mandatory}}</td>
                    <td>{{detail.notes}}</td>
                </tr>
                </tbody>
            </table>
        </tab>
        <tab heading="Code Sample">
            <br />
	        <div ng-init="loadCode(path + 'core/registry/index.js', 'registryjsCode');">
		        <div id="registryjsCode"></div>
	        </div>
            <em>The above snippet is taken from dev.js file which represents the development environment of SOAJS in the registry.</em>
        </tab>
    </tabset>
    <script>renderCodeSnippets();</script>
</div>