<a id="module"></a>
<h1>Dashboard UI Module</h1>
<div class="white-container">
	<p>
		UI Modules are graphical interfaces that offer the ability to send and retrieve information to the services APIs. They are located in <a href="https://www.npmjs.com/packages/soajs.dashboard" target="_blank">soajs.dashboard</a> under folder <b>ui/modules/</b>. SOAJS UI Dashboard is built on top of <a href="http://www.angularjs.org" target="_blank">AngularJS</a> which makes it a Single Page Applications (SPAs). The modules inside the UI are built to be loaded on demand and their controllers are registered upon loading.
	</p>
	<hr/>
	<h3>Creating a Module</h3>
	<p>
		Start by installing <a href="https://www.npmjs.com/packages/soajs.dashboard" target="_blank">soajs.dashboard</a> by following the instruction in the deployment section either <a href="#/documentation/deployment/manual">Manually</a> or via <a href="#/documentation/deployment/docker">Docker</a>.
	</p>
	<ol>
		<li>Navigate to <b>soajs.dashboard/ui/modules/</b> folder</li>
		<li>Create your module by adding a folder <b>myModule</b></li>
		<li>Create the installation file and name it <b>install.js</b></li>
	</ol>
	<b>Folder Schema:</b>
	<pre><code class="bash">$ cd soajs.dashboard/ui/modules/ && ls -l
# output
drwxr-xr-x  5 root  wheel   170 May 29 19:19 myModule

$ ls -l myModule
# output
drwxr-xr-x  3 root  wheel   102 May 29 19:07 directives
-rw-r--r--  1 root  wheel   484 May 29 19:19 install.js
-rw-r--r--  1 root  wheel  1335 May 29 19:17 controller.js
-rw-r--r--  1 root  wheel  1335 May 29 19:17 service.js

$ ls -l myModule/directives
# output
-rw-r--r--  1 root  wheel  116 May 29 18:37 list.tmpl</code></pre>
	<hr/>
	<h3>Installing a Module</h3>
	<p>
		Every module has an installation file <b>install.js</b>, that tells the main application about the location of the module's scripts, directives &amp; services, the permissions to be applied and which menu the module is accessible from. Installing a UI module does not mean that its information is stored in the database, the UI only loads the information and adds it to its navigation granting the user access to that module.
	</p>
	<p>
		The installation file contains an array of entries that point to the module's pages. Following the same concept of SPAs, a module should have at least One page meaning One entry in the array. The following table explains the content of one entry in the installation array:
	</p>
	<table width="100%" class="myTable">
		<thead>
			<tr>
				<th>Name</th>
				<th>Type</th>
				<th>Mandatory</th>
				<th>Description</th>
			</tr>
		</thead>
		<tbody>
			<tr ng-repeat="entry in module" ng-class="{'first': $first, 'last': $last}" ng-class-odd="'odd'" ng-class-even="'even'">
				<td>{{entry.name}}</td>
				<td>{{entry.type}}</td>
				<td>{{entry.mandatory}}</td>
				<td ng-bind-html="entry.description"></td>
			</tr>
		</tbody>
	</table>
	<br/>
	<b>Install.js Code Sample</b>
	<pre><code class="javascript">var myModuleNav =[
	{
		'id': 'myModules',
		'label': 'My Module',
		'url': '#/mymodule',
		'scripts': ['modules/myModule/controller.js'],
		'tplPath': 'modules/myModule/directives/list.tmpl',
		'checkPermission':{
			'service':'mymodule',
			'route':'/list'
		},
		'icon': '',
		'mainMenu': true,
		'tracker': true,
		'ancestor': ['Home']
	}
];

//add the module to the dashboard navigation
navigation = navigation.concat(myModuleNav);</code></pre>
	<p>
		Once you create the <b>install.js</b> file, edit the <b>soajs.dashboard/ui/index.html</b> file and point out ist location in the <b>&lt;head&gt;</b> tag. Refresh the page and the Dashboard UI will pick up your module's location, once the main controller starts, it will load your module.
	</p>
	<div class="redFlag"><b>Note:</b><br />Add the entry of <b>modules/myModule/install.js</b> before the dashboard main controller entry <b>app/controller.js</b>.</div>
	<div ng-init="loadHTML(path+'ui/module/head.html','head');">
		<div id="head"></div>
	</div>
	<hr/>
	<h3>Module Controllers</h3>
	<p>
		As mentioned above, a module is loaded on demand. The dashboard's main controller uses the <a href="https://docs.angularjs.org/api/ng/provider/$controllerProvider" target="_blank">$controllerProvider</a> service of AngularJS to register the module's controllers when the module is loaded. The controller allows the module to control and apply the two way data binding between the module's scope and its html directives. Once a module's controller is registered, it gains access to the global scope of the application.
	</p>
	<b>Controller Code Sample</b>
	<pre><code class="javascript">var myModule = soajsApp.components;
myModule.controller('myModuleCtrl', ['$scope', function($scope) {
	//module's code goes here
}]);</code></pre>
	<p>
		The module's controller and the main application's controller behave the same way; they both provide the scope and use <a href="https://docs.angularjs.org/guide/di" target="_blank">dependency injections</a>. You can learn more about controllers on <a href="https://docs.angularjs.org/guide/controller" target="_blank">AngularJs</a>. Once your controller is defined, you can create your functions and implement the business logic of the module.
	</p>
	<pre><code class="javascript">var myModule = soajsApp.components;
myModule.controller('myModuleCtrl', ['$scope', function($scope) {
	//module's code goes here
	$scope.listEntries = function(){
		//invokes an api and returns an array of data objects
		$scope.entries = APIresponse;
	};

	$scope.getOneEntry = function(entryId){
		//...
	};

	$scope.listEntries();
}]);</code></pre>
	<hr/>
	<h3>Module Service</h3>
	<p>
		AngularJS provides the ability to use services by injecting them in the controller as <a href="https://docs.angularjs.org/guide/di" target="_blank">dependencies</a>. You can either inject a native AngularJS <a href="https://docs.angularjs.org/guide/services" target="_blank">service</a> or a custom service you created. Similar to how you create a module controller, the dashboard's main controller uses the <a href="https://docs.angularjs.org/api/auto/service/$provide" target="_blank">$provide</a> service to offer you the ability to register your custom services with the <a href="https://docs.angularjs.org/api/auto/service/$injector" target="_blank">$injector</a>. Once registerd, you can inject them as dependencies in your module's controller.
	</p>
	<b>Service Code Sample</b>
	<pre><code class="javascript">var myModuleService = soajsApp.components;
myModuleService.service('myModuleSrv', ['$timeout', '$http', function($timeout, $http){
	return {
		'getEntriesFromAPI': function(opts, callback){
			var config = {
				url: opts.url,
				method: opts.method
			};
			$http(config).success(function(response, status, headers, config) {
				$timeout(function(){
					return callback(null, response);
				}, 500);
			}).error(function(errData, status, headers, config) {
				$timeout(function(){
					return callback(errData);
				}, 500);
			});
		}
	};
}]);</code></pre>
	<hr/>
	<h3>Module Directives</h3>
	<p>
		Directives are markers on a DOM element that tell the HTML compiler of AngularJS to attach the behavior of your Module to the DOM element or even transform it. Consider the code above where the controller calls list entries, and the later after invoking some API returns an array of data objects representing records you want to print; use the directives to print these records.
	</p>
	<b>Directive Code Sample:</b>
	<div ng-init="loadHTML(path+'ui/module/directive.html','directive');">
		<div id="directive"></div>
	</div>
	<p>
		The above code snippet loops in the array of data fetch by <b>listEntries</b> function in the controller, and for each entry, it prints the name and description as instructed. Also notice that for the directive to function, you need to provide it with the name of the controller of your module (line 1).
	</p>
	<hr/>
	<h3>Module Permissions</h3>
	<p>
		SOAJS <a href="#/documentation/core/acl">Access Level</a>, is applied on the service APIs. This means that Dashboard UI should read the user ACL, and display what is allowed accordingly. Because your service and your module are separate, you need to define the permissions of the module separately.<br />
	</p>
	<b>UI module permissions:</b>
	<pre><code class="javascript">var permissions = {
	'list': ['myService', '/list'],
	'add': ['myService', '/add']
};</code></pre>
	<ol>
		<li>The object keys are the names of the operations we will use in the UI interface.</li>
		<li>The first entry in the array, is the name that matches your service.</li>
		<li>The second entry in the array, is the name of the API in your service.</li>
	</ol>
	<p>
		If the ACL provides access to <b>myService/list</b>, then the first entry in the above object will resolve to TRUE.
	</p>
	<p>
		SOAJS dashboard offers the ability that compares the above permissions object with the ACL. The result is stored in the scope of the module so you can use it in your module's code or directive(s). A predefined method in the Dashboard UI named <b>constructModulePermissions</b> handles this task.
	</p>
	<table width="100%" class="myTable">
		<thead>
			<tr>
				<th>Parameter Name</th>
				<th>Parameter Order</th>
				<th>Description</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td>Scope</td>
				<td>1</td>
				<td>The UI Module Scope</td>
			</tr>
			<tr class="even">
				<td>Access</td>
				<td>2</td>
				<td>An Object in the scope to store the result of the ACL check</td>
			</tr>
			<tr>
				<td>Permissions</td>
				<td>3</td>
				<td>The UI Module permissions</td>
			</tr>
		</tbody>
	</table>
	<br/>
	<b>Example:</b>
	<pre><code class="javascript">var permissions = {
	'list': ['myService', '/list'],
	'add': ['myService', '/add']
};

//create an entry in your module scope
$scope.access = {};

//call the method and compare the permissions with the ACL
//allowed permissions are then stored in scope.access
constructModulePermissions($scope, $scope.access, permissions);</code></pre>
	<p>
		Now that your module is aware of what is allowed, apply the ACL either in your controller's code or the directive(s) where needed.
	</p>
	<b>Apply the ACL in the Controller:</b>
	<pre><code class="javascript">var myModule = soajsApp.components;
myModule.controller('myModuleCtrl', ['$scope', function($scope) {
	var permissions = {
		'list': ['myService', '/list'],
		'add': ['myService', '/add']
	};

	//create an entry in your module scope
	$scope.access = {};

	//call the method and compare the permissions with the ACL
	//allowed permissions are then stored in scope.access
	constructModulePermissions($scope, $scope.access, permissions);

	$scope.listEntries = function(){ };

	//if scope.access.list is allowed, call listEntries
	if($scope.access.list) {
		$scope.listEntries();
	}
}]);</code></pre>
	<b>Apply the ACL in a directive:</b>
	<div ng-init="loadHTML(path+'ui/module/directiveacl.html','directiveacl');">
		<div id="directiveacl"></div>
	</div>
	<br/>
	<hr/>
	<h3>Wrapping it Up</h3>
	<p>
		Let's build a module, that has the following:
	</p>
	<ol>
		<li>One Page Module containing the list of data entries</li>
		<li>On the same page above the list, show <b>Add New Entry</b> button</li>
		<li>When <b>Add New Entry</b> is clicked, show a form above the list (do not redirect to another page)</li>
		<li>When form is submitted, post the values to a remote API.</li>
	</ol>
	<p>
		<b><u>Hints:</u></b><br/>
		- We will use <b>service.js</b> to connect to remote APIs to fetch and send data.<br />
		- We will also use the <a href="#/documentation/ui/grid">Grid UI</a> to display the data in directive <b>list.tmpl</b> and the <a href="#/documentation/ui/form">Form UI</a> to generate a form for the user.
	</p>
	<tabset>
		<tab heading="install.js">
			<p>
				<b>Step1:</b> create the module installation file as instructed above
			</p>
			<div ng-init="loadCode(path+'ui/module/install.js','install');">
				<div id="install"></div>
			</div>
		</tab>
		<tab heading="controller.js">
			<p>
				<b>Step4:</b> Create the controller with 3 functions: listEntries - addEntry - viewEntry.
			</p>
			<ul>
				<li><b>listEntries:</b> Calls the service to get the data from remote API, constructs the configuration of the Grid UI, invokes <b>buildGrid</b> to print the data</li>
				<li><b>viewEntry:</b> Invoked through grid when View Item button is pressed.</li>
				<li>
					<b>addEntry:</b> Invoked when <b>Add New Entry</b> was pressed, generates form and attaches submit and reset operations.
					<ul>
						<li><b>Reset:</b> empties the form and closes the modal overlay</li>
						<li><b>Submit:</b> calls the services to post the data to the remote API</li>
					</ul>
				</li>
			</ul>
			<div ng-init="loadCode(path+'ui/module/controller.js','controller');">
				<div id="controller"></div>
			</div>
		</tab>
		<tab heading="list.tmpl">
			<p>
				<b>Step3:</b> create the directive to display the <b>Add new Entry</b> button and the <b>Grid UI</b>
			</p>
			<div ng-init="loadHTML(path+'ui/module/list.html','list');">
				<div id="list"></div>
			</div>
		</tab>
		<tab heading="service.js">
			<p>
				<b>Step4:</b> create a custom service
			</p>
			<div ng-init="loadCode(path+'ui/module/service.js','service');">
				<div id="service"></div>
			</div>
		</tab>
	</tabset>
</div>